---
title: "Un joli titre pour le dashboard"
author: "Marie-Pierre Etienne"
output: 
  flexdashboard::flex_dashboard:
    theme: bootstrap
    orientation: columns
    vertical_layout: fill
    navbar:
      - { title: "Moodle", href: "https://tice.agrocampus-ouest.fr/course/view.php?id=6726", align: left }
      - { icon: "fa-twitter", href: "https://twitter.com/marie_etienne", align: right }
      - { icon: "fa-linkedin", href: "https://www.linkedin.com/in/marie-etienne-818a7115/", align: right }
params:
  setup_path: ../resources/
---

<style>                     
.navbar {
  background-color:#46ACC8;
  border-color:#46ACC8;
}
.navbar-brand {
color:black!important;
}

</style>   


```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(ggplot2)
library(plotly)
library(sf)
library(maps)
```

Importation des données et chargement des packages


### Graphique A

```{r}
religion_brut <- read.csv("projet/WRP national data.csv")
country_code <- read.csv("projet/Country_code.csv", sep=':')
data <- read.csv("projet/alcool_religion.csv", header = TRUE, encoding = 'latin1', sep = ';')

colnames(data)

world_sf <- map_data("world")

religion_signif <- data %>% 
  select(Country, ends_with("_percent")) %>% 
  pivot_longer(cols = ends_with("_percent"), names_to = "religion", values_to = "percent") %>% 
  filter(percent>0.05) %>% 
  pivot_wider(names_from = religion, values_from = percent)

religion_main <- data %>% 
  select(Country, ends_with("_percent")) %>% 
  select(-total_percent) %>% 
  pivot_longer(cols = ends_with("_percent"), names_to = "religion", values_to = "percent") %>% 
  group_by(Country) %>% 
  filter(percent==max(percent)) %>% 
  separate(religion, c("main", 'suffix'), sep = '_') %>% 
  select(-suffix)
    
religion_map <- religion_main %>%
  mutate(region = fct_recode(Country, "USA" = "United States",
                             "UK" = "United Kingdom",
                             "Trinidad" = "Trinidad and Tobago",
                             "Ivory Coast" = "Cote d'Ivoire",
                             "Democratic Republic of the Congo" = "Dem. Rep. Congo",
                             "North Macedonia" = "Macedonia",
                             "Republic of Congo" = "Rep. Congo")) %>% 
  mutate(main = droplevels(as.factor(main))) %>% 
  right_join(world_sf, by = "region") %>% 
  ggplot() +
  aes(fill = main, x = long, y = lat, group = group) +
  geom_polygon() 
  coord_map("mercator")


test <- world_sf %>% 
  rename(Country = region) %>% 
  full_join(country_code, by = "Country") %>% 
  filter(is.na(long) | is.na(Code)) %>% 
  group_by(Country) %>% 
  summarize_if(is.numeric, mean) 

country_code <- country_code %>% 
  mutate(Country = fct_recode(Country,
                              "Antigua" = "Antigua and Barbuda",
                              "Bolivia" = "Bolivia (Plurinational State of)",
                              "Bonaire" = "Bonaire, Sint Eustatius and Saba",
                              "Brunei" = "Brunei Darussalam",
                              "Cape Verde" = "Cabo Verde",
                              "Cocos Islands" = "Cocos (Keeling) Islands",
                              "Democratic Republic of the Congo" = "Congo, Democratic Republic of the",
                              "Czech Republic" = "Czechia",
                              "Ivory Coast" = "Côte d'Ivoire",
                              "Curacao" = "Curaçao",
                              "Falkland Islands" = "Falkland Islands (Malvinas)",
                              "French Southern and Antarctic Lands" = "	French Southern Territories",
                              "Heard Island" = "Heard Island and McDonald Islands",
                              "Iran" = "Iran (Islamic Republic of)",
                              "North Korea" = "Korea (Democratic People's Republic of",
                              "Laos" = "Lao People's Democratic Republic",
                              "Micronesia" = "Micronesia (Federated States of)",
                              "Moldova" = "Moldova, Republic of",
                              "Palestine" = "Palestine, State of",
                              "Pitcairn Islands" = "Pitcairn",
                              "Republic of Congo" = "Congo",
                              "Reunion" = "Réunion",
                              "Russia" = "Russian Federation",
                              "Saint Barthelemy" = "Saint Barthélemy",
                              "Saint Helena" = "Saint Helena, Ascension and Tristan da Cunha",
                              "Saint Kitts" = "Saint Kitts and Nevis",
                              "Saint Martin" = "Saint Martin (French part)",
                              "Saint Vincent" = "Saint Vincent and the Grenadines",
                              "Sint Maarten" = "Sint Maarten (Dutch part)",
                              "South Georgia" = "South Georgia and the South Sandwich Islands",
                              "South Korea" = "Korea, Republic of",
                              "Syria" = "Syrian Arab Republic",
                              "Taiwan" = "Taiwan, Province of China",
                              "Tanzania" = "Tanzania, United Republic of",
                              "UK" = "United Kingdom of Great Britain and Northern Ireland",
                              "USA" = "United States of America",
                              "Venezuela" = "Venezuela (Bolivarian Republic of)",
                              "Vietnam" = "Viet Nam"))


```

### Graphique B
Graphique de la consommation de Bière, Vin et Spiritueux en fonction de la religion (majoritaire dans chaque pays)

```{r}
data <- read.delim("~/Agro/5A/Visualisation de donnees/Projet/alcool_religion.csv", sep = ";", dec=".")
religion_main <- data %>% 
  select(Country,ends_with("PerCapita"), ends_with("_percent")) %>% 
  select(-total_percent) %>% 
  pivot_longer(cols = ends_with("_percent"), names_to = "religion", values_to = "percent") %>% 
  group_by(Country) %>% 
  filter(percent==max(percent)) %>% 
  separate(religion, c("main", 'suffix'), sep = '_') %>% 
  select(-suffix) %>% 
  group_by(main) %>% 
  mutate(n = n()) %>% 
  filter(n>1) %>% 
  select(-n) %>% 
  pivot_longer(cols = 3:5, names_to = "Type" ) %>%
  mutate(Type = as.factor(Type))# %>% 


graph2 <- ggplot(data = religion_main)+
  aes(x=main, y=value, fill = Type)+
  geom_boxplot(outlier.shape=NA)+
  scale_fill_manual(values=c("darkgoldenrod1","aquamarine4", "darkred")) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
graph2 

```

### Graphique C

```{r}
data <- read.delim("~/Agro/5A/Visualisation de donnees/Projet/alcool_religion.csv", sep = ";", dec=".")
data_islam <- data %>% 
  select(7,8,9,65) %>% 
  pivot_longer(cols = 1:3, names_to = "Type" ) %>%
  mutate(Type = as.factor(Type))


graph3 <-ggplot(data=data_islam, aes(x=islam_percent, y= value, color=Type)) +
  geom_point()+
  geom_smooth(method=lm, se=FALSE, fullrange=TRUE)+
  scale_color_manual(values=c("darkgoldenrod1","aquamarine4", "darkred"))
graph3
```


<!-- Column {data-width=650} -->
<!-- ----------------------------------------------------------------------- -->

<!-- ### An easy solution for dashboard -->

<!-- ```{r, echo = TRUE} -->
<!-- #install.package('flexdasboard') -->
<!-- #rmarkdown::draft("dashboard.Rmd", template = "flex_dashboard", package = "flexdashboard") -->
<!-- ``` -->

<!-- The [flexdashboard website](https://rmarkdown.rstudio.com/flexdashboard/index.html) provides multiple advanced examples. -->

<!-- ### Some static graph -->

<!-- ```{r data, eval = TRUE, echo = FALSE, results='hide', message = FALSE, warning=FALSE} -->
<!-- n <- 100 -->
<!-- dta <- tibble(size = round(rnorm(n, mean = 0, sd =10),2),  -->
<!--            color = sample(x= c('Blue', 'Yellow'), size = n, replace = TRUE)) -->

<!-- ``` -->


<!-- ```{r graph_static,  echo = FALSE,  message = FALSE, warning=FALSE} -->
<!-- p1 <- dta %>% ggplot() + -->
<!--   aes(x=color, y = size) + -->
<!--   geom_boxplot(aes(fill= color)) -->
<!-- p1 -->
<!-- ``` -->

<!-- Column {.tabset .tabset-fade} -->
<!-- ----------------------------------------------------------------------- -->


<!-- ### Some dynamic maps -->

<!-- ```{r  ggplotly, echo = TRUE,  eval = TRUE,  message = FALSE, warning=FALSE} -->
<!-- plotly::ggplotly(p1) -->
<!-- ``` -->



<!-- ### Chart C -->

<!-- ```{r} -->

<!-- ``` -->

