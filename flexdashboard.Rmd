---
title: "Religions et consommation d'alcool"
author: "Clara Gougeon, Lucille Caradec et Laudine Bertrand"
output: 
  flexdashboard::flex_dashboard:
    theme: bootstrap
    orientation: columns
    vertical_layout: fill
    navbar:
      - { title: "Moodle", href: "https://tice.agrocampus-ouest.fr/course/view.php?id=6726", align: left }
params:
  setup_path: ../resources/
---

<style>                     
.navbar {
  background-color:#46ACC8;
  border-color:#46ACC8;
}
.navbar-brand {
color:black!important;
}

</style>   


```{r setup, include=FALSE}
# Chargement des packages 
library(flexdashboard)
library(tidyverse)
library(ggplot2)
library(plotly)
library(sf)
library(maps)
library(dplyr)
library(highcharter) 
library(mapproj)
```

```{r data, include=FALSE}
# Importation des trois jeux de données brutes : 
religion_brut <- read.csv("WRP national data.csv")
alcool_brut <- read.csv("HappinessAlcoholConsumption.csv")

# Jointures entre les jeux de données
alcool_religion <- countrycode::codelist %>% 
  select(country.name.en, cowc) %>% 
  rename(Country = country.name.en) %>% 
  right_join(alcool_brut, by = "Country") %>% 
  rename(name = cowc) %>% 
  full_join(religion_brut, by = "name") 
```

Cartes
=======================================================================

### Religions majoritaires et consommation d'alcool à travers le monde

```{r}
world_sf <- map_data("world")

religion_main <- religion_brut %>% 
  filter(year==2010) %>% 
  select(name, ends_with("pct"), nonreligpct, -ends_with("genpct"), -sumreligpct,
         hindgenpct, sikhgenpct, shntgenpct, zorogenpct, bahgenpct,
         taogenpct, confgenpct, anmgenpct) %>% 
  pivot_longer(cols = c(ends_with("pct"), nonreligpct), 
               names_to = "religion", values_to = "percent") %>% 
  group_by(name) %>% 
  filter(percent==max(percent)) %>% 
  mutate(religion = as.factor(religion)) %>% 
  mutate(religion = fct_recode(religion,
                               'buddistes' = "budmahpct",
                               'buddistes' = "budothrpct",
                               'buddistes' = "budthrpct",
                               'chrétiens - protestants' = "chrstangpct",
                               'chrétiens - catholiques' = "chrstcatpct",
                               'chrétiens - orthodoxes' = "chrstorthpct",
                               'chrétiens - protestants' = "chrstprotpct",
                               'chrétiens - autres' = "chrstothrpct",
                               'musulmans - sunnites' = "islmsunpct",
                               'musulmans - shiites' = "islmshipct",
                               'musulmans - autres' = "islmothrpct",
                               'juifs orthodoxes' = "judorthpct",
                               'athées' = "nonreligpct",
                               'animistes' = "anmgenpct",
                               'hindous' = "hindgenpct",
                               'shintoistes' = "shntgenpct"
                               ))

palette_religion = c(
  `chrétiens - catholiques` = "#00b4ff",
  `chrétiens - orthodoxes` = "#009eff",
  `chrétiens - protestants` = "#0066ff",
  `chrétiens - autres` = "#004fff",
  `musulmans - sunnites` = "#4d7f17",
  `musulmans - shiites` = "#6bb120",
  `musulmans - autres` = "#8ae429",
  `juifs orthodoxes` = "#ea8611",
  `buddistes` = "#ffd966",
  `athées` = "#cc0000",
  `animistes` = "#7e0f12",
  `hindous` = "#6a329f",
  `shintoistes` = "#c90076"
)

religion_map <- religion_main %>%
  rename(cowc = name) %>% 
  full_join(countrycode::codelist, by = "cowc") %>% 
  select(country.name.en, religion, percent, cowc) %>% 
  rename(region = country.name.en) %>% 
  mutate(region = as.factor(region)) %>% 
  mutate(region = fct_recode(region,
                             "USA" = "United States",
                             "UK" = "United Kingdom",
                             "Antigua" = "Antigua & Barbuda",
                            "Bosnia and Herzegovina"  = "Bosnia & Herzegovina",
                            "Republic of Congo" = "Congo - Brazzaville",
                            "Democratic Republic of the Congo" = "Congo - Kinshasa",
                            "Ivory Coast" = "Côte d’Ivoire",
                            "Czech Republic" = "Czechia",
                            "Myanmar" = "Myanmar (Burma)"
                             )) %>% 
  full_join(world_sf, by = 'region') %>% 
  ggplot() +
  aes(fill = religion, x = long, y = lat, group = group) +
  geom_polygon() +
  coord_map("mercator", xlim = c(-180,180), ylim = c(-55, 80)) +
  scale_fill_manual(values = palette_religion) +
  xlab('') + ylab('') +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank()) +
  ggtitle("Religions majoritaires dans le monde") 

religion_map
```

Boxplots - religions
=======================================================================

### Consommation d'alcool en fonction des 4 grandes religions : Christianisme, Islamisme, Athéisme et Bouddhisme

```{r}
conso_religions_majoritaires <- alcool_religion %>% 
    select(Country, ends_with("PerCapita"), -GDP_PerCapita, chrstprotpct, chrstcatpct, chrstorthpct, chrstangpct, chrstothrpct, budgenpct, islmgenpct, nonreligpct) %>%
  pivot_longer(cols = ends_with("pct"), names_to = "religion", values_to = "percent") %>% 
  group_by(Country) %>% 
  filter(percent==max(percent)) %>%
  mutate(religion = as.factor(religion)) %>% 
  mutate(religion = fct_recode(religion,
                               'Bouddhistes' = "budgenpct",
                               'Chrétiens' = "chrstangpct",
                               'Chrétiens' = "chrstcatpct",
                               'Chrétiens' = "chrstorthpct",
                               'Chrétiens' = "chrstprotpct",
                               'Chrétiens' = "chrstothrpct",
                               'Musulmans' = "islmgenpct",
                               'Athées' = "nonreligpct"
                               )) %>%
  pivot_longer(cols = 2:4, names_to = "Type" ) %>%
  mutate(Type = as.factor(Type)) 

graph_religions <- ggplot(data = conso_religions_majoritaires) 
graph_religions <- graph_religions + aes(x=religion, y=value, fill = Type) 
graph_religions <- graph_religions + geom_hline(yintercept = 100, col = "black", linetype="dashed")
graph_religions <- graph_religions + geom_hline(yintercept = 200, col = "black", linetype="dashed")
graph_religions <- graph_religions + geom_hline(yintercept = 300, col = "black", linetype="dashed")
graph_religions <- graph_religions + geom_boxplot(outlier.shape=NA) 
graph_religions <- graph_religions +  scale_fill_manual(values=c("darkgoldenrod1","aquamarine4", "darkred"),name = "Type d'alcool", labels = c("Bière", "Spiritueux", "Vin"))
graph_religions <- graph_religions + theme(plot.margin = unit(c(1,1,1,1), "lines"))
graph_religions <- graph_religions + theme(axis.text.x = element_text(angle = 65, hjust = 1,size=10),axis.line = element_line(colour = "black", size = 1, linetype = "solid"),axis.text.y = element_text(size=10))
graph_religions <- graph_religions + theme(legend.position="bottom") 
graph_religions <- graph_religions + labs(x="",y="",title="Représentation de la consommation d'alcool par habitant \nen fonction des religions majoritaires",subtitle="Spécification sur la consommation d'alcool : bière, spiritueux ou vin")
graph_religions <- graph_religions + theme(plot.title = element_text(face = "bold", size = 14,hjust=0.5), plot.subtitle = element_text(size = 11,hjust=0.5))
graph_religions <- graph_religions + scale_x_discrete(limits=c("Chrétiens","Musulmans","Bouddhistes", "Athées"))
graph_religions <- graph_religions + scale_y_continuous(labels=c("0 L","100 L","200 L","300 L","400 L"))
graph_religions <- graph_religions + annotate("rect", xmin = c(0.55,1.55,2.55,3.55), xmax = c(1.45,2.45,3.45,4.45), ymin = -5, ymax = 410, fill = c("#009eff","#4d7f17","#ffd966","#cc0000"), alpha = 0.1) 
graph_religions <- graph_religions + theme(panel.background = element_rect(fill = "white",size = 2))
graph_religions 
```

Boxplots - Christianisme 
=======================================================================

### Zoom : Consommation d'alcool en fonction des 4 sous-religions du Christianisme : Catholicisme, Protestantisme, Christianisme orthodoxe, et autres Christianismes.

```{r}
conso_christianisme <- alcool_religion %>% 
    select(Country, ends_with("PerCapita"), -GDP_PerCapita, chrstprotpct, chrstcatpct, chrstorthpct, chrstangpct, chrstothrpct) %>%
  pivot_longer(cols = ends_with("pct"), names_to = "religion", values_to = "percent") %>% 
  group_by(Country) %>% 
  filter(percent==max(percent)) %>%
  mutate(religion = as.factor(religion)) %>% 
  mutate(religion = fct_recode(religion,
                               'Protestants' = "chrstangpct",
                               'Catholiques' = "chrstcatpct",
                               'Orthodoxes' = "chrstorthpct",
                               'Protestants' = "chrstprotpct",
                               'Autres' = "chrstothrpct"
                               )) %>%
  pivot_longer(cols = 2:4, names_to = "Type" ) %>%
  mutate(Type = as.factor(Type)) 

graph_christ <- ggplot(data = conso_christianisme) 
graph_christ <- graph_christ + aes(x=religion, y=value, fill = Type) 
graph_christ <- graph_christ + geom_hline(yintercept = 100, col = "black", linetype="dashed")
graph_christ <- graph_christ + geom_hline(yintercept = 200, col = "black", linetype="dashed")
graph_christ <- graph_christ + geom_hline(yintercept = 300, col = "black", linetype="dashed")
graph_christ <- graph_christ + geom_boxplot(outlier.shape=NA) 
graph_christ <- graph_christ +  scale_fill_manual(values=c("darkgoldenrod1","aquamarine4", "darkred"),name = "Type d'alcool", labels = c("Bière", "Spiritueux", "Vin"))
graph_christ <- graph_christ + theme(plot.margin = unit(c(1,1,1,1), "lines"))
graph_christ <- graph_christ + theme(axis.text.x = element_text(angle = 65, hjust = 1,size=10),axis.line = element_line(colour = "black", size = 1, linetype = "solid"),axis.text.y = element_text(size=10))
graph_christ <- graph_christ + theme(legend.position="bottom") 
graph_christ <- graph_christ + labs(x="",y="",title="Représentation de la consommation d'alcool par habitant \nen fonction des sous-religions du christianisme",subtitle="Spécification sur la consommation d'alcool : bière, spiritueux ou vin")
graph_christ <- graph_christ + theme(plot.title = element_text(face = "bold", size = 14,hjust=0.5), plot.subtitle = element_text(size = 11,hjust=0.5))
graph_christ <- graph_christ + scale_x_discrete(limits=c("Catholiques","Orthodoxes", "Protestants","Autres"))
graph_christ <- graph_christ + scale_y_continuous(labels=c("0 L","100 L","200 L","300 L","400 L"))
graph_christ <- graph_christ + annotate("rect", xmin = c(0.55,1.55,2.55,3.55), xmax = c(1.45,2.45,3.45,4.45), ymin = -5, ymax = 410, fill = c("#00b4ff","#009eff","#0066ff","#004fff"), alpha = 0.1) 
graph_christ <- graph_christ + theme(panel.background = element_rect(fill = "white",size = 2))


graph_christ
```

Graphique à finir
=======================================================================

### Graphique C : 

```{r}
print("Ca marche")
```
